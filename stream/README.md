# 下载视频流的笔记

# 分析

录制视频流时会限制单个文件的大小，即当保存到视频文件超过限定的大小，就换新文件继续保存

而根据视频流含有的视频头信息，分为两种类型：

* 头信息只在当次请求的视频流开始处含有，如 "flv"
* 头信息在每个视频的片段开头都含有，如 "m3u8"

第一种的处理办法是，每换一个新文件都重新读取视频响应流

第二种的处理办法是，下载分段到文件夹，当总字节数超过限制时，通过`FFmpeg`合并该文件夹下的视频为一个完整视频，并且创建新文件夹继续保存

# 过程

1. 执行请求视频流的 URL，获取响应的数据流
2. 循环读取、写入视频数据到文件，在每次写完读取的缓冲数据后，判断字节数是否超过了限制。超过就发送当前视频到视频处理器，并且换新文件继续保存。注意也要重置临时变量（如总字节数）
3. 在结束读取视频流时（包括正常读完、发生错误），一定要处理最后的视频文件，即发送到视频处理器去处理（可以先判断视频文件是否存在）